import{s as M}from"./button-BG3rqky_.js";import{s as R}from"./menu-BG4fEp25.js";import{i as I,k as E}from"./index-CFNcU0YK.js";import{n as A}from"./navigate-Dfi05TM4.js";import{d as L,aA as h,ay as N,aB as T,m as _,r as g,ag as u,I as q,o as z,J as D,a as w,R as m,u as F}from"./@vue-BpwAlabI.js";const J={class:"mx-auto max-w-3xl"},U={class:"text-right"},Q=L({__name:"Form",props:h({loading:{type:Boolean}},{modelValue:{required:!0},modelModifiers:{}}),emits:h(["submit"],["update:modelValue"]),setup(x,{emit:k}){const y=k,b=N("dom"),e=T(x,"modelValue"),V=_(()=>({name:I(),code:I()})),i=g([]),f=g([]),B=()=>{R().execute({status:[0]}).then(({data:a})=>i.value=a),M().execute({status:[0]}).then(({data:a})=>f.value=a);const r=_(()=>{const a=i.value.filter(n=>!n.acls).map(n=>({...n,buttons:f.value.filter(t=>t.menuId===n.id)}));return E(a)});return{schemas:[{colProps:{span:12,xs:24},tag:"ElInput",formItemProps:{prop:"name",label:"角色名称"}},{colProps:{span:12,xs:24},tag:"ElInput",formItemProps:{prop:"code",label:"角色代码"}},{formItemProps:{prop:"roleIds",label:"角色权限"},component:()=>{const a=t=>{var l;(l=e.value.menuIDs)!=null&&l.includes(t)?e.value.menuIDs=e.value.menuIDs.filter(s=>s!==t):e.value.menuIDs=[...e.value.menuIDs??[],t]},n=t=>{var l;(l=e.value.buttonIDs)!=null&&l.includes(t)?e.value.buttonIDs=e.value.buttonIDs.filter(s=>s!==t):e.value.buttonIDs=[...e.value.buttonIDs??[],t]};return m(u("el-table"),{data:r.value,border:!0,"default-expand-all":!0,"show-header":!1,"row-key":"id",size:"small",style:"--el-table-tr-bg-color: unset"},{default:()=>[m(u("el-table-column"),null,{default:({row:{id:t,name:l}})=>{var s;return m(u("el-checkbox"),{value:t,label:l,"model-value":(s=e.value.menuIDs)==null?void 0:s.includes(t),onChange:()=>a(t)},null)}}),m(u("el-table-column"),null,{default:({row:{buttons:t}})=>t.map(({id:l,name:s})=>{var o;return m(u("el-checkbox"),{key:l,value:l,label:s,"model-value":(o=e.value.buttonIDs)==null?void 0:o.includes(l),onChange:()=>n(l)},null)})})]})}},{tag:"ElSelect",formItemProps:{prop:"status",label:"角色状态"}}]}},{schemas:C}=B(),P=()=>A.back({link:"/administrator/role"}),S=()=>{var t,l,s;e.value.menuIDs=(t=e.value.menuIDs)==null?void 0:t.filter(o=>i.value.find(d=>d.id===o)),e.value.buttonIDs=(l=e.value.buttonIDs)==null?void 0:l.filter(o=>{var v;const d=f.value.find(p=>p.id===o);return d?(v=e.value.menuIDs)==null?void 0:v.includes(d.menuId):!1});const r=new Set(e.value.menuIDs),c=new Set(e.value.buttonIDs),a=i.value.filter(o=>r.has(o.id)),n=f.value.filter(o=>c.has(o.id));a.forEach(o=>{if(!o.acls)return;n.find(v=>{var p;return(p=o.acls)==null?void 0:p.includes(v.code)})?r.add(o.id):r.delete(o.id)}),e.value.menuIDs=Array.from(r),e.value.buttonIDs=Array.from(c),(s=b.value)!=null&&s.formRef&&b.value.formRef.validate().then(()=>y("submit"))};return(r,c)=>{const a=u("widget-cancel"),n=u("widget-submit"),t=u("common-form"),l=u("el-card");return z(),q(l,{shadow:"never",class:"!border-0"},{default:D(()=>[w("div",J,[m(t,{ref_key:"dom",ref:b,modelValue:e.value,"onUpdate:modelValue":c[0]||(c[0]=s=>e.value=s),rules:V.value,schemas:F(C)},{default:D(()=>[w("div",U,[m(a,{onClick:P}),m(n,{loading:r.loading,onClick:S},null,8,["loading"])])]),_:1},8,["modelValue","rules","schemas"])])]),_:1})}}});export{Q as _};
